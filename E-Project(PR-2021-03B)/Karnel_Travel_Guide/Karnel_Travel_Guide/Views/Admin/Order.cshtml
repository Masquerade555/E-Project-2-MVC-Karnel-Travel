@model IEnumerable<Karnel_Travel_Guide.Models.tb_orders>
@using Karnel_Travel_Guide.Models;
@{
    Karnel_Travel_GuideEntities db = new Karnel_Travel_GuideEntities();
}

<link href="~/Content/font-awesome.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap.min.js"></script>
<style>
    table {
        border: 1px solid #ccc;
        border-collapse: collapse;
        margin: 0;
        padding: 0;
        width: 100%;
        table-layout: fixed;
    }

        table caption {
            font-size: 1.5em;
            margin: .5em 0 .75em;
        }

        table tr {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: .35em;
        }

        table th,
        table td {
            padding: .625em;
            text-align: center;
        }

        table th {
            font-size: .85em;
            letter-spacing: .1em;
            text-transform: uppercase;
        }

    

    span {
        cursor: pointer;
    }
</style>



<table class="container-md">
    <thead>
        <tr>
            <th scope="col">Order Id</th>
            <th scope="col">Order Date</th>
            <th scope="col">Customer Name</th>
            <th scope="col">Customer Address</th>
            <th scope="col">Order Total</th>
            <th scope="col">Payment</th>
            <th scope="col">Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            string[] List = item.o_items.Split(',');
            //string[] qty = item.o_quantity.Split(',');
            item.ProductId1 = item.o_quantity.Split(',').Select(x => int.Parse(x)).ToList();
            item.ProductId2 = item.o_quantity.Split(',').Select(x => int.Parse(x)).ToList();
            item.ProductId3 = item.o_quantity.Split(',').Select(x => int.Parse(x)).ToList();
            item.ProductId4 = item.o_quantity.Split(',').Select(x => int.Parse(x)).ToList();
            item.ProductId5 = item.o_quantity.Split(',').Select(x => int.Parse(x)).ToList();
            item.ProductId6 = item.o_quantity.Split(',').Select(x => int.Parse(x)).ToList();

            var delivery = List.Count() * 100;
            var sub = item.o_total - delivery;


        <tr>
            <td scope="row" data-label="Order Id">@item.o_id</td>
            <td data-label="Placed on Date">@item.o_date</td>
            <td data-label="Customer Name">@item.o_billing_name</td>
            <td data-label="Customer Address">@item.o_billing_city</td>
            <td data-label="Order Amount">Rs @item.o_total/-</td>
            <td data-label="Payment">@item.o_payment</td>

            <td>
                <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#A_@item.o_id">
                    View
                </button>
                <select class="form-control m-2 update_status" data-id="@item.o_id">
                    <option selected disabled hidden>@item.o_status</option>
                    <option>Booked</option>
                    <option>Pending</option>

                </select>
            </td>
        </tr>



            <!-- Modal -->
            <div class="modal fade" id="A_@item.o_id" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">Order</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="modal-body">
                            <h5 class="text-center mb-4">Products</h5>

                            <div class="row">
                                @for (int i = 0; i < List.Length; i++)
                                {
                                    int id = Convert.ToInt32(List[i]);
                                    var data = db.tb_transportation.Where(x => x.tr_id == id).SingleOrDefault();
                                    if (data != null)
                                    {
                                        //var price = data.tr_price * Convert.ToInt32(qty[i]);
                                        var a = item.ProductId1[i] * data.tr_price;


                                <div class="col-md-4 col-sm-6 col-6">
                                    <div class="border mb-3">
                                        <img src="@Url.Content(data.tr_images)" width="100%" height="100px" />
                                        <br />
                                        <small class="mt-1">
                                            <a href="/Home/P_V_tr/@data.tr_id" target="_blank" class="text-dark text-decoration-none">@data.tr_name</a>
                                        </small>
                                        <div>
                                            <small>Qty: @item.ProductId1[i]</small>
                                            <br />
                                            <strong>Rs @a/-</strong>
                                        </div>
                                    </div>
                                </div>
                                    }
                                }
                                @for (int i = 0; i < List.Length; i++)
                                {
                                    int id = Convert.ToInt32(List[i]);
                                    var data = db.tb_tour.Where(x => x.to_id == id).SingleOrDefault();
                                    if (data != null)
                                    {
                                        var price = data.to_price * Convert.ToInt32(item.ProductId2[i]);

                                    <div class="col-md-4 col-sm-6 col-6">
                                        <div class="border mb-3">
                                            <img src="@Url.Content(data.to_images)" width="100%" height="100px" />
                                            <br />
                                            <small class="mt-1">
                                                <a href="/Home/P_V_to/@data.to_id" target="_blank" class="text-dark text-decoration-none">@data.to_name</a>
                                            </small>
                                            <div>
                                                <small>Qty: @item.ProductId2[i]</small>
                                                <br />
                                                <strong>Rs @price/-</strong>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                }
                                @for (int i = 0; i < List.Length; i++)
                                {
                                    int id = Convert.ToInt32(List[i]);
                                    var data = db.tb_restaurant.Where(x => x.rest_id == id).SingleOrDefault();
                                    if (data != null)
                                    {
                                        var price = data.rest_price * Convert.ToInt32(item.ProductId3[i]);

                                    <div class="col-md-4 col-sm-6 col-6">
                                        <div class="border mb-3">
                                            <img src="@Url.Content(data.rest_images)" width="100%" height="100px" />
                                            <br />
                                            <small class="mt-1">
                                                <a href="/Home/P_V_rest/@data.rest_id" target="_blank" class="text-dark text-decoration-none">@data.rest_name</a>
                                            </small>
                                            <div>
                                                <small>Qty: @item.ProductId3[i]</small>
                                                <br />
                                                <strong>Rs @price/-</strong>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                }
                                @for (int i = 0; i < List.Length; i++)
                                {
                                    int id = Convert.ToInt32(List[i]);
                                    var data = db.tb_resorts.Where(x => x.reso_id == id).SingleOrDefault();
                                    if (data != null)
                                    {
                                        var price = data.reso_price * Convert.ToInt32(item.ProductId4[i]);

                                    <div class="col-md-4 col-sm-6 col-6">
                                        <div class="border mb-3">
                                            <img src="@Url.Content(data.reso_images)" width="100%" height="100px" />
                                            <br />
                                            <small class="mt-1">
                                                <a href="/Home/P_V_reso/@data.reso_id" target="_blank" class="text-dark text-decoration-none">@data.reso_name</a>
                                            </small>
                                            <div>
                                                <small>Qty: @item.ProductId4[i]</small>
                                                <br />
                                                <strong>Rs @price/-</strong>
                                            </div>
                                        </div>
                                    </div>
                                    }

                                }
                                @for (int i = 0; i < List.Length; i++)
                                {
                                    int id = Convert.ToInt32(List[i]);
                                    var data = db.tb_packages.Where(x => x.pac_id == id).SingleOrDefault();
                                    if (data != null)
                                    {
                                        var price = data.pac_price * Convert.ToInt32(item.ProductId5[i]);

                                    <div class="col-md-4 col-sm-6 col-6">
                                        <div class="border mb-3">
                                            <img src="@Url.Content(data.pac_images)" width="100%" height="100px" />
                                            <br />
                                            <small class="mt-1">
                                                <a href="/Home/P_V_pac/@data.pac_id" target="_blank" class="text-dark text-decoration-none">@data.pac_name</a>
                                            </small>
                                            <div>
                                                <small>Qty: @item.ProductId5[i]</small>
                                                <br />
                                                <strong>Rs @price/-</strong>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                }
                                @for (int i = 0; i < List.Length; i++)
                                {
                                    int id = Convert.ToInt32(List[i]);
                                    var data = db.tb_hotels.Where(x => x.h_id == id).SingleOrDefault();
                                    if (data != null)
                                    {
                                        var price = data.h_price * Convert.ToInt32(item.ProductId6[i]);

                                    <div class="col-md-4 col-sm-6 col-6">
                                        <div class="border mb-3">
                                            <img src="@Url.Content(data.h_images)" width="100%" height="100px" />
                                            <br />
                                            <small class="mt-1">
                                                <a href="/Home/P_V_h/@data.h_id" target="_blank" class="text-dark text-decoration-none">@data.h_name</a>
                                            </small>
                                            <div>
                                                <small>Qty: @item.ProductId6[i]</small>
                                                <br />
                                                <strong>Rs @price/-</strong>
                                            </div>
                                        </div>
                                    </div>
                                    }
                                }

                            </div>
                            <br />
                            <div>
                                <h5>Details:-</h5>

                                <div>
                                    <span>Sub Total:- Rs @sub/-</span>
                                    <br />
                                    <span>Delivery Charges:- Rs @delivery/-</span>
                                    <br />
                                    <span>Total Amount:- Rs @item.o_total/-</span>
                                    <br />
                                    <span>Status:- @item.o_status</span>
                                    <br />
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>



        }

    </tbody>
</table>

<script src="~/Scripts/jquery-3.6.0.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    $(".update_status").change(function () {
        var v = $(this).children("option:selected").val();
        $.ajax({
            url: "/Admin/Order_Update",
            type: 'POST',
            cache: false,
            data: { status: v, id: $(this).attr("data-id") },
            success: function (result) {
                $('#admin_container').html(result);
                swal("Done", "Update Successfully", "success");

            }
        });

    })


</script>


